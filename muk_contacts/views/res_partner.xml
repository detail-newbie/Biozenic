<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="view_partner_search" model="ir.ui.view">
	    <field name="name">res.partner.search</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_res_partner_filter"/>
        <field name="arch" type="xml">
        	<xpath expr="//field[@name='name']" position="attributes">
                <attribute name="filter_domain">
					[
						'|',
						'|',
						'|',
						'|',
						'|',
						('complete_name', 'ilike', self),
						('ref', '=', self),
						('email', 'ilike', self),
						('vat', 'ilike', self),
						('company_registry', 'ilike', self),
						('contact_number', 'ilike', self),
					]
				</attribute>
            </xpath>
			<xpath expr="//field[@name='user_id']" position="after">
				<separator/>
				<filter
					string="Main Contacts"
					name="filter_top_level"
					domain="['|', ('parent_id', '=', False), ('is_company', '=', True)]"
				/>
			</xpath>
			<xpath expr="//filter[@name='inactive']" position="before">
                <filter 
					string="All" 
					name="all" 
					domain="['|', ('active', '=', False), ('active', '=', True)]"
				/>
			</xpath>
			<xpath expr="//group" position="after">
                <searchpanel>
                    <field 
                        name="company_id" 
                        groups="base.group_multi_company" 
                        icon="fa-building"
                    />
                    <field name="country_id" icon="fa fa-globe"/>
                    <field 
                        name="category_id"
                        string="Tags"
                        icon="fa-tags"
                        select="multi"
                    />
                </searchpanel>
            </xpath>
        </field>
    </record>
    
    <record id="view_partner_list" model="ir.ui.view">
	    <field name="name">res.partner.list</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_tree"/>
        <field name="arch" type="xml">
	        <xpath expr="//list" position="attributes">
				<attribute name="decoration-bf">is_company</attribute>
				<attribute name="decoration-muted">not active</attribute>
				<attribute name="decoration-info">(type == 'delivery')</attribute>
				<attribute name="decoration-success">(type == 'invoice')</attribute>
				<attribute name="decoration-warning">(type == 'other')</attribute>
			</xpath>
	        <xpath expr="//field[@name='complete_name']" position="before">
				<field 
					name="company_type" 
					nolabel="1"
					widget="selection_icons" 
					options="{'icons': {'person': 'user', 'company': 'building'}}"
					invisible="type != 'contact'"
					optional="show" 
				/>
				<field 
					name="type" 
					nolabel="1"
					widget="selection_icons" 
					options="{'icons': {'contact': 'address-book', 'invoice': 'usd', 'delivery': 'truck', 'other': 'address-book-o'}}"
					optional="show" 
				/>
				<field 
					name="comment" 
					nolabel="1"
					widget="text_icon" 
					optional="show" 
				/>
				<field name="contact_number" optional="show" />
				<field name="commercial_company_name" string="Company" optional="show" />
			</xpath>
            <xpath expr="//field[@name='complete_name']" position="attributes">
            	<attribute name="string">Complete Name</attribute>
            	<attribute name="optional">hide</attribute>
            </xpath>
			<xpath expr="//field[@name='complete_name']" position="after">
				<field name="name" optional="show" invisible="is_company"/>
			</xpath>
        </field>
    </record>

    <record id="view_partner_form" model="ir.ui.view">
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form" />
        <field name="arch" type="xml">
            <xpath expr="//span[@name='address_name']" position="before">
            	<label for="contact_number" invisible="parent_id" />
            	<div class="o_row align-items-center" invisible="parent_id">
					<field 
						name="contact_number" 
						placeholder="is filled in automatically"
						class="w-100"
					/>
					<button 
						name="action_generate_contact_number" 
						type="object"
						icon="fa-plus-circle" 
						class="oe_link oe_inline oe_edit_only ml-1"
						style="vertical-align: baseline;" 
						title="Generate Contact Number"
						invisible="contact_number or parent_id" 
					/>
            	</div>
            </xpath>
			<xpath expr="//group[@name='misc']" position="before">
				<group string="Default Address">
					<field name="default_invoice_partner_id" string="Invoice"/>
					<field name="default_delivery_partner_id" string="Delivery"/>
				</group>
			</xpath>
            <xpath expr="//field[@name='child_ids']" position="attributes">
            	<attribute name="mode">list,kanban</attribute>
            </xpath>
            <xpath expr="//field[@name='child_ids']" position="inside">
				<list decoration-bf="is_company">
					<field name="is_company" column_invisible="1"/>
                    <field 
						name="avatar_128" 
						widget="image" 
						options="{'size': [24, 24], 'img_class': 'o_avatar rounded'}" 
						width="30" 
						nolabel="1"
					/>
					<field name="name"/>
					<field name="phone" optional="show"/>
					<field name="email" optional="show"/>
					<field name="street" optional="hide"/>
					<field name="zip" optional="hide"/>
					<field name="city" optional="show"/>
					<field name="country_id" optional="hide"/>
					<field
						name="type" 
						widget="badge"
						decoration-info="type == 'delivery'"
						decoration-success="type == 'invoice'"
						decoration-warning="type == 'other'"
					/>
					<button 
						name="action_view_partner" 
						class="btn btn-link text-primary" 
						type="object" 
						string="Open View"  
					/>
				</list>
            </xpath>
        </field>
    </record>

</odoo>
